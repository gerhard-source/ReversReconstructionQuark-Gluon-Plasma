name: Continuous Integration

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        pip install pytest
    
    - name: Run unit tests
      run: |
        python -m pytest tests/ -v
    
    - name: Test core functionality
      run: |
        python -c "import sys; sys.path.append('src'); from reverse_reconstruction import ReverseReconstruction; rr = ReverseReconstruction(); print('ReverseReconstruction imported successfully')"
    
    - name: Generate example output
      run: |
        python examples/basic_usage.py
    
  build-paper:
    runs-on: ubuntu-latest
    needs: test
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Install LaTeX
      run: |
        sudo apt-get update
        sudo apt-get install -y texlive-latex-base texlive-latex-extra texlive-science texlive-bibtex-extra
    
    - name: Compile paper
      run: |
        cd publications
        make
    
    - name: Upload PDF artifact
      uses: actions/upload-artifact@v3
      with:
        name: preprint-pdf
        path: publications/arxiv_preprint.pdf
